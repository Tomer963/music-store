<!-- Checkout Component -->
<div class="checkout-page">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <app-spinner></app-spinner>
  </div>

  <!-- Checkout Content -->
  <div class="checkout-content" *ngIf="!isLoading">
    <div class="container">
      <h1 class="page-title">Checkout</h1>

      <!-- Progress Indicator -->
      <div class="checkout-progress">
        <div class="progress-step" [class]="getStepClass(CheckoutStep.BILLING)" (click)="goToStep(CheckoutStep.BILLING)">
          <div class="step-number">1</div>
          <div class="step-label">Billing Info</div>
        </div>
        <div class="progress-line" [class.completed]="currentStep > CheckoutStep.BILLING"></div>
        <div class="progress-step" [class]="getStepClass(CheckoutStep.PAYMENT)" (click)="goToStep(CheckoutStep.PAYMENT)">
          <div class="step-number">2</div>
          <div class="step-label">Payment</div>
        </div>
        <div class="progress-line" [class.completed]="currentStep > CheckoutStep.PAYMENT"></div>
        <div class="progress-step" [class]="getStepClass(CheckoutStep.REVIEW)">
          <div class="step-number">3</div>
          <div class="step-label">Review</div>
        </div>
      </div>

      <div class="checkout-forms">
        <!-- Step 1: Billing Information -->
        <div class="checkout-step" *ngIf="currentStep === CheckoutStep.BILLING">
          <h2>Billing Information</h2>
          <form [formGroup]="billingForm" class="billing-form">
            <div class="form-group">
              <label class="form-label">Address *</label>
              <input type="text" class="form-control" formControlName="address" placeholder="123 Main St">
              <div class="form-error" *ngIf="billingForm.get('address')?.touched && billingForm.get('address')?.errors?.['required']">
                Address is required
              </div>
              <div class="form-error" *ngIf="billingForm.get('address')?.touched && billingForm.get('address')?.errors?.['pattern']">
                Address must contain at least 3 letters and a number
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">City *</label>
              <input type="text" class="form-control" formControlName="city" placeholder="New York">
              <div class="form-error" *ngIf="billingForm.get('city')?.touched && billingForm.get('city')?.errors?.['required']">
                City is required
              </div>
              <div class="form-error" *ngIf="billingForm.get('city')?.touched && billingForm.get('city')?.errors?.['pattern']">
                City must contain only letters
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Zip Code *</label>
              <input type="text" class="form-control" formControlName="zipCode" placeholder="12345">
              <div class="form-error" *ngIf="billingForm.get('zipCode')?.touched && billingForm.get('zipCode')?.errors?.['required']">
                Zip code is required
              </div>
              <div class="form-error" *ngIf="billingForm.get('zipCode')?.touched && billingForm.get('zipCode')?.errors?.['pattern']">
                Zip code must be 5 digits
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Phone *</label>
              <input type="text" class="form-control" formControlName="phone" placeholder="03-1234567">
              <div class="form-error" *ngIf="billingForm.get('phone')?.touched && billingForm.get('phone')?.errors?.['required']">
                Phone is required
              </div>
              <div class="form-error" *ngIf="billingForm.get('phone')?.touched && billingForm.get('phone')?.errors?.['pattern']">
                Phone must be in format 03-1234567 or 050-1234567
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!billingForm.valid">
                Continue to Payment
              </button>
            </div>
          </form>
        </div>

        <!-- Step 2: Payment Information -->
        <div class="checkout-step" *ngIf="currentStep === CheckoutStep.PAYMENT">
          <h2>Payment Information</h2>
          <form [formGroup]="paymentForm" class="payment-form">
            <div class="payment-methods">
              <label class="payment-method">
                <input type="radio" formControlName="paymentMethod" [value]="PaymentMethod.CREDIT_CARD">
                <span>Credit Card</span>
              </label>
              <label class="payment-method">
                <input type="radio" formControlName="paymentMethod" [value]="PaymentMethod.CHECK">
                <span>Check</span>
              </label>
            </div>

            <!-- Credit Card Fields -->
            <div class="credit-card-fields" *ngIf="paymentForm.get('paymentMethod')?.value === PaymentMethod.CREDIT_CARD">
              <div class="form-group">
                <label class="form-label">Card Type *</label>
                <select class="form-control" formControlName="cardType">
                  <option value="">Select card type</option>
                  <option value="visa">Visa</option>
                  <option value="mastercard">Mastercard</option>
                  <option value="direct">Direct</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Card Number *</label>
                <input type="text" class="form-control" formControlName="cardNumber" placeholder="1234567812345678">
              </div>

              <div class="form-group">
                <label class="form-label">Cardholder Name *</label>
                <input type="text" class="form-control" formControlName="cardholderName" placeholder="John Doe">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Expiry Month *</label>
                  <input type="number" class="form-control" formControlName="expiryMonth" placeholder="MM" min="1" max="12">
                </div>
                <div class="form-group">
                  <label class="form-label">Expiry Year *</label>
                  <input type="number" class="form-control" formControlName="expiryYear" placeholder="YYYY" [min]="2024">
                </div>
                <div class="form-group">
                  <label class="form-label">CVV *</label>
                  <input type="text" class="form-control" formControlName="cvv" placeholder="123">
                </div>
              </div>
            </div>

            <!-- Check Field -->
            <div class="check-fields" *ngIf="paymentForm.get('paymentMethod')?.value === PaymentMethod.CHECK">
              <div class="form-group">
                <label class="form-label">Check Number *</label>
                <input type="text" class="form-control" formControlName="checkNumber" placeholder="123456">
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="previousStep()">Back</button>
              <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!paymentForm.valid">
                Review Order
              </button>
            </div>
          </form>
        </div>

        <!-- Step 3: Review Order -->
        <div class="checkout-step" *ngIf="currentStep === CheckoutStep.REVIEW">
          <h2>Review Your Order</h2>
          
          <div class="order-summary">
            <h3>Order Items</h3>
            <div class="cart-items">
              <div class="cart-item" *ngFor="let item of cart.items">
                <div class="item-info">
                  <span class="item-title">{{ item.album.title }}</span>
                  <span class="item-artist">{{ item.album.artist }}</span>
                </div>
                <div class="item-quantity">Qty: {{ item.quantity }}</div>
                <div class="item-price">{{ formatPrice(item.album.price * item.quantity) }}</div>
              </div>
            </div>
            
            <div class="order-total">
              <span>Total:</span>
              <span class="total-amount">{{ formatPrice(cart.total) }}</span>
            </div>
          </div>

          <div class="billing-summary">
            <h3>Billing Information</h3>
            <p>{{ billingForm.value.address }}</p>
            <p>{{ billingForm.value.city }}, {{ billingForm.value.zipCode }}</p>
            <p>Phone: {{ billingForm.value.phone }}</p>
          </div>

          <div class="payment-summary">
            <h3>Payment Method</h3>
            <p *ngIf="paymentForm.value.paymentMethod === PaymentMethod.CREDIT_CARD">
              {{ paymentForm.value.cardType | uppercase }} ending in 
              {{ paymentForm.value.cardNumber.slice(-4) }}
            </p>
            <p *ngIf="paymentForm.value.paymentMethod === PaymentMethod.CHECK">
              Check #{{ paymentForm.value.checkNumber }}
            </p>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="previousStep()">Back</button>
            <button type="button" class="btn btn-primary" (click)="placeOrder()" [disabled]="isProcessing">
              <span *ngIf="!isProcessing">Place Order</span>
              <app-spinner *ngIf="isProcessing" [size]="'small'" [color]="'white'"></app-spinner>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>